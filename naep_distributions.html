<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NAEP Grade 4 Reading · Score Distributions 2024</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;700;800&family=Syne+Mono&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  background: #f5f0e8;
  color: #1a1510;
  font-family: 'Syne', sans-serif;
  min-height: 100vh;
  padding: 32px 28px 60px;
}

.page { max-width: 1100px; margin: 0 auto; }

header {
  margin-bottom: 36px;
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
  flex-wrap: wrap;
  gap: 20px;
}

.title-block {}

.kicker {
  font-family: 'Syne Mono', monospace;
  font-size: 11px;
  letter-spacing: 0.18em;
  text-transform: uppercase;
  color: #8a7a60;
  margin-bottom: 10px;
}

h1 {
  font-size: clamp(26px, 4vw, 44px);
  font-weight: 800;
  line-height: 1.05;
  color: #1a1510;
}

h1 span { color: #c8440a; }

.subtitle {
  font-size: 14px;
  color: #8a7a60;
  margin-top: 10px;
  font-weight: 400;
  max-width: 440px;
  line-height: 1.5;
}

/* Controls */
.controls {
  background: white;
  border-radius: 12px;
  padding: 20px 24px;
  margin-bottom: 24px;
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
  align-items: flex-start;
  box-shadow: 0 2px 12px rgba(0,0,0,0.06);
}

.control-group { display: flex; flex-direction: column; gap: 6px; }

.control-label {
  font-family: 'Syne Mono', monospace;
  font-size: 10px;
  letter-spacing: 0.14em;
  text-transform: uppercase;
  color: #8a7a60;
}

select, input[type=text] {
  font-family: 'Syne', sans-serif;
  font-size: 13px;
  padding: 8px 12px;
  border: 1.5px solid #ddd5c5;
  border-radius: 6px;
  background: #fdfaf5;
  color: #1a1510;
  outline: none;
  cursor: pointer;
  transition: border-color 0.2s;
}

select:focus, input:focus { border-color: #c8440a; }

.state-chips {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  max-width: 600px;
}

.chip {
  display: flex;
  align-items: center;
  gap: 5px;
  padding: 4px 10px 4px 8px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: opacity 0.15s;
  color: white;
}

.chip .chip-x {
  font-size: 14px;
  line-height: 1;
  opacity: 0.7;
}

.chip:hover .chip-x { opacity: 1; }

.btn {
  font-family: 'Syne', sans-serif;
  font-size: 12px;
  font-weight: 700;
  padding: 8px 16px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  transition: all 0.15s;
  letter-spacing: 0.03em;
}

.btn-outline {
  background: transparent;
  border: 1.5px solid #ddd5c5;
  color: #8a7a60;
}

.btn-outline:hover { border-color: #c8440a; color: #c8440a; }

.btn-primary {
  background: #c8440a;
  color: white;
}
.btn-primary:hover { background: #a33508; }

/* Chart area */
.chart-container {
  background: white;
  border-radius: 12px;
  padding: 28px 32px 20px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.06);
  position: relative;
}

canvas {
  display: block;
  width: 100%;
}

.chart-note {
  font-family: 'Syne Mono', monospace;
  font-size: 10px;
  color: #b0a090;
  margin-top: 12px;
  text-align: right;
  letter-spacing: 0.06em;
}

/* Tooltip */
#tooltip {
  position: fixed;
  background: #1a1510;
  color: #f5f0e8;
  border-radius: 8px;
  padding: 12px 16px;
  font-size: 12px;
  pointer-events: none;
  z-index: 1000;
  display: none;
  min-width: 180px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.25);
}

#tooltip.show { display: block; }

.tip-name {
  font-weight: 800;
  font-size: 14px;
  margin-bottom: 6px;
}

.tip-row {
  display: flex;
  justify-content: space-between;
  gap: 16px;
  color: #b0a090;
  margin-bottom: 2px;
}

.tip-val { color: #f5f0e8; font-weight: 600; font-family: 'Syne Mono', monospace; }

/* Legend */
.legend-area {
  margin-top: 20px;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 7px;
  font-size: 12px;
  padding: 5px 10px;
  border-radius: 20px;
  background: #fdfaf5;
  border: 1.5px solid transparent;
  cursor: pointer;
  transition: all 0.15s;
  font-weight: 500;
}

.legend-item:hover { border-color: currentColor; }

.legend-swatch {
  width: 24px;
  height: 3px;
  border-radius: 2px;
  flex-shrink: 0;
}

/* Stat row */
.stats-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 14px;
  margin-bottom: 24px;
}

.stat-box {
  background: white;
  border-radius: 10px;
  padding: 16px 18px;
  box-shadow: 0 1px 8px rgba(0,0,0,0.05);
}

.stat-box-label {
  font-family: 'Syne Mono', monospace;
  font-size: 10px;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: #b0a090;
  margin-bottom: 4px;
}

.stat-box-val {
  font-size: 22px;
  font-weight: 800;
  color: #1a1510;
}

.stat-box-sub {
  font-size: 11px;
  color: #b0a090;
  margin-top: 2px;
}
</style>
</head>
<body>
<div class="page">

<header>
  <div class="title-block">
    <div class="kicker">NAEP · Grade 4 Reading · 2024</div>
    <h1>Score<br><span>Distribution</span><br>by State</h1>
    <div class="subtitle">How scores spread across students — not just the average. Each curve shows the full distribution of students across score ranges.</div>
  </div>
</header>

<div class="stats-row" id="stats-row"></div>

<div class="controls">
  <div class="control-group">
    <div class="control-label">Add states to compare</div>
    <div style="display:flex;gap:8px;align-items:center">
      <select id="state-select">
        <option value="">— choose a state —</option>
      </select>
      <button class="btn btn-primary" onclick="addSelected()">Add</button>
      <button class="btn btn-outline" onclick="resetToPreset()">Reset</button>
    </div>
  </div>
  <div class="control-group">
    <div class="control-label">Active comparisons</div>
    <div class="state-chips" id="chips"></div>
  </div>
</div>

<div class="chart-container">
  <canvas id="chart" height="420"></canvas>
  <div class="legend-area" id="legend"></div>
  <div class="chart-note">Hover over curves for details · % of students at each 10-point score band</div>
</div>

<div id="tooltip">
  <div class="tip-name" id="tip-name"></div>
  <div class="tip-row"><span>Score range</span><span class="tip-val" id="tip-range"></span></div>
  <div class="tip-row"><span>% of students</span><span class="tip-val" id="tip-pct"></span></div>
  <div class="tip-row"><span>State avg</span><span class="tip-val" id="tip-avg"></span></div>
</div>

</div>

<script>
const DATA = {"bins":["0-10","10-20","20-30","30-40","40-50","50-60","60-70","70-80","80-90","90-100","100-110","110-120","120-130","130-140","140-150","150-160","160-170","170-180","180-190","190-200","200-210","210-220","220-230","230-240","240-250","250-260","260-270","270-280","280-290","290-300","300-310","310-320","320-330","330-340","340-350","350-360","360-370","370-380","380-390","390-400","400-410","410-420","420-430","430-440","440-450","450-460","460-470","470-480","480-490","490-500"],"states":[{"name":"DoDEA","avg":234.2,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.3,0.6,1.0,1.7,2.6,3.9,5.4,7.1,8.9,10.4,11.8,12.3,10.8,9.1,6.5,3.9,2.0,1.0,0.3,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Massachusetts","avg":224.8,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.3,0.5,0.8,1.3,1.8,2.4,3.3,4.1,5.0,6.1,7.3,8.7,9.5,10.1,9.8,8.4,6.8,5.6,3.6,2.4,1.1,0.5,0.2,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Wyoming","avg":221.9,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.2,0.4,0.7,1.0,1.6,2.2,3.2,4.1,5.2,6.7,8.7,10.1,11.1,11.0,10.5,8.9,6.6,4.0,2.2,1.0,0.4,0.1,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"New Jersey","avg":221.6,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.2,0.4,0.6,0.9,1.3,1.5,2.1,2.6,3.3,3.8,4.9,5.9,7.7,8.7,9.5,10.1,9.3,8.4,6.5,4.9,3.3,2.0,1.1,0.5,0.2,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"New Hampshire","avg":221.5,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.2,0.5,0.8,1.3,1.8,2.4,3.1,4.2,5.6,6.7,8.1,9.5,10.7,10.7,10.6,8.3,6.6,4.1,2.4,1.2,0.6,0.2,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Colorado","avg":220.9,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.2,0.4,0.7,1.3,2.0,2.6,3.8,4.6,5.8,7.0,8.3,9.3,10.2,10.0,9.3,8.1,6.3,4.4,2.8,1.5,0.8,0.3,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Indiana","avg":220.1,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.3,0.5,0.9,1.4,1.9,2.7,3.3,4.4,5.6,6.8,8.6,9.8,10.9,10.2,9.5,8.0,6.0,4.1,2.4,1.4,0.7,0.2,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Utah","avg":219.3,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.3,0.4,0.7,1.1,1.4,2.1,2.9,3.6,4.5,5.6,6.7,7.4,8.4,9.7,10.7,10.1,8.7,6.6,4.2,2.4,1.2,0.6,0.2,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Connecticut","avg":219.2,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.2,0.4,0.8,1.2,1.8,2.4,3.0,3.8,4.9,5.6,6.4,7.6,8.8,9.1,9.5,9.1,8.0,6.6,4.6,2.8,1.6,0.9,0.4,0.1,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Mississippi","avg":218.5,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.2,0.5,0.7,1.1,1.8,2.3,3.4,4.6,6.0,7.6,9.0,10.6,11.1,11.0,10.0,8.3,5.6,3.2,1.6,0.7,0.3,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Florida","avg":218.2,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.2,0.6,0.9,1.4,2.2,2.9,3.9,4.8,6.0,7.5,8.8,9.2,9.9,10.4,9.2,7.4,6.1,3.9,2.3,1.2,0.5,0.2,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Kentucky","avg":218.0,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.2,0.3,0.5,1.0,1.4,2.1,3.1,4.0,4.9,6.1,7.1,8.6,9.7,10.1,10.0,9.0,7.4,5.7,3.7,2.3,1.3,0.8,0.3,0.2,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Montana","avg":217.2,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.3,0.5,0.9,1.4,2.0,2.7,3.9,4.9,6.2,7.6,9.0,10.2,10.2,10.1,9.7,8.0,5.5,3.4,1.8,0.9,0.4,0.1,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Rhode Island","avg":216.3,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.3,0.5,0.8,1.2,1.8,2.6,3.2,4.0,5.2,5.9,7.2,8.1,9.2,9.6,9.5,8.8,7.4,5.6,3.8,2.5,1.4,0.6,0.3,0.1,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Louisiana","avg":216.0,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.2,0.2,0.5,0.7,1.3,1.6,2.2,3.1,4.3,5.3,6.2,7.3,8.4,9.5,9.7,9.5,8.8,7.1,5.6,3.6,2.3,1.4,0.6,0.3,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Ohio","avg":216.0,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.2,0.3,0.5,0.7,1.2,1.7,2.6,3.2,4.1,4.7,5.6,6.8,8.4,9.5,10.0,9.9,9.3,7.9,5.9,3.6,2.0,0.9,0.5,0.2,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Hawaii","avg":215.8,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.2,0.2,0.4,0.7,1.2,1.8,2.3,2.9,4.1,5.0,6.0,7.4,8.5,9.5,10.1,9.8,9.1,7.5,5.7,3.4,2.3,1.1,0.4,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Pennsylvania","avg":215.8,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.3,0.6,0.9,1.2,1.9,2.6,3.4,3.9,4.5,5.6,6.4,7.8,9.3,10.0,10.3,9.9,8.0,5.9,3.7,1.9,0.9,0.4,0.2,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Idaho","avg":215.7,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.2,0.2,0.4,0.7,1.1,1.6,2.5,3.3,4.1,5.1,6.1,6.9,8.0,8.9,10.2,10.9,9.7,7.9,5.4,3.3,1.9,0.8,0.4,0.1,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Washington","avg":215.7,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.2,0.5,0.8,1.2,1.9,2.6,3.4,4.2,5.0,6.0,7.2,8.2,9.0,9.8,10.0,8.9,7.4,5.4,3.7,2.4,1.3,0.5,0.2,0.1,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Maryland","avg":215.6,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.3,0.6,0.8,1.5,2.2,3.0,3.8,4.6,5.3,6.1,6.5,7.6,8.1,8.9,8.7,8.0,7.0,5.8,4.6,3.0,1.8,0.9,0.3,0.2,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"North Dakota","avg":215.5,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.3,0.5,0.8,1.3,1.7,2.5,3.8,4.8,6.5,8.1,9.8,10.7,11.4,11.1,9.8,7.6,4.8,2.4,1.1,0.4,0.2,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Wisconsin","avg":215.3,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.2,0.3,0.5,0.9,1.4,1.8,2.4,3.0,3.8,4.5,5.8,7.4,8.7,9.6,10.2,10.0,9.1,7.7,5.7,3.5,1.9,0.9,0.4,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Tennessee","avg":215.1,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.2,0.3,0.6,0.9,1.2,2.1,2.6,3.4,4.0,4.7,5.6,6.7,8.1,8.9,10.3,10.4,9.1,7.3,5.5,3.8,2.3,1.0,0.4,0.2,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"National","avg":215.0,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.3,0.5,0.8,1.2,1.8,2.5,3.3,4.2,5.0,6.1,7.2,8.4,9.4,9.9,9.9,9.0,7.4,5.5,3.5,2.0,1.0,0.5,0.2,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"South Carolina","avg":214.9,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.2,0.3,0.6,0.9,1.2,1.9,2.7,3.5,4.4,5.3,6.0,7.0,7.8,8.8,9.2,9.3,9.1,7.6,5.8,3.9,2.4,1.2,0.5,0.2,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Iowa","avg":214.6,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.2,0.4,0.7,1.1,1.6,2.2,3.2,4.1,4.9,6.1,7.6,9.2,10.5,11.0,10.0,9.3,7.2,4.9,3.1,1.7,0.7,0.2,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"New York","avg":214.6,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.2,0.3,0.5,0.9,1.1,1.8,2.6,3.5,4.4,5.2,6.0,7.4,8.4,9.7,9.4,9.4,8.3,7.4,5.2,3.8,2.4,1.2,0.5,0.3,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Georgia","avg":214.4,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.3,0.5,1.0,1.3,2.1,2.6,3.3,4.3,5.2,6.1,7.2,8.4,9.2,9.9,10.0,8.4,7.2,5.2,3.5,2.1,1.1,0.6,0.2,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Minnesota","avg":214.4,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.2,0.3,0.6,0.8,1.3,1.8,2.3,3.0,3.8,4.7,5.9,7.5,8.6,9.7,10.2,10.6,10.0,7.6,5.2,3.1,1.6,0.7,0.3,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Illinois","avg":214.2,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.2,0.3,0.5,0.8,1.2,1.9,2.7,3.5,4.4,5.3,6.3,7.0,8.1,9.1,10.1,9.8,8.4,6.8,5.3,3.6,2.2,1.3,0.7,0.3,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"South Dakota","avg":214.1,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.2,0.4,0.6,1.1,1.5,2.3,2.9,4.1,5.1,6.3,8.0,9.2,10.6,10.8,10.7,9.0,7.1,4.8,2.7,1.4,0.6,0.3,0.1,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Virginia","avg":214.1,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.2,0.5,0.9,1.4,2.0,2.7,3.4,4.4,5.2,6.3,7.5,8.8,9.3,9.5,8.7,8.4,7.3,5.6,3.7,2.1,1.0,0.5,0.2,0.1,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"North Carolina","avg":213.4,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.2,0.3,0.6,1.0,1.5,2.0,2.7,3.7,4.3,5.3,6.1,7.1,8.6,9.1,9.8,9.2,8.7,6.8,5.3,3.5,2.0,1.1,0.5,0.3,0.1,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Alabama","avg":213.2,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.2,0.4,0.6,1.0,1.9,2.4,3.6,4.4,5.7,6.8,8.2,9.2,9.9,10.1,9.4,8.1,6.8,4.7,3.2,1.8,0.9,0.4,0.2,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Kansas","avg":213.1,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.1,0.3,0.4,0.9,1.2,1.9,2.4,3.3,4.2,5.2,5.9,7.3,8.9,10.0,10.9,10.9,9.4,7.1,4.7,2.7,1.3,0.6,0.2,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Nevada","avg":213.1,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.2,0.3,0.6,0.9,1.3,1.9,2.8,3.4,4.4,5.2,6.3,7.4,8.3,9.2,9.8,9.9,9.0,7.3,5.2,3.2,1.7,0.9,0.4,0.2,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Vermont","avg":212.7,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.2,0.3,0.6,0.9,1.5,2.1,2.9,3.5,4.5,5.8,6.4,6.8,7.6,8.9,9.5,9.7,8.8,7.5,5.4,3.6,1.8,0.9,0.4,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Missouri","avg":211.9,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.3,0.6,0.8,1.4,1.9,2.7,3.3,4.4,5.0,6.4,7.8,9.1,10.2,10.4,10.3,8.5,6.6,4.4,3.0,1.6,0.7,0.3,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Texas","avg":211.9,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.2,0.5,0.7,1.2,1.9,2.8,3.6,4.6,5.4,6.7,8.0,8.8,9.9,10.0,9.8,8.6,6.6,4.6,2.9,1.6,0.7,0.3,0.2,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"California","avg":211.7,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.2,0.4,0.8,1.4,2.0,2.9,4.1,4.9,5.9,6.7,7.4,8.6,9.4,9.3,8.8,8.3,7.0,5.2,3.2,1.8,0.9,0.4,0.2,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Nebraska","avg":211.7,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.2,0.3,0.5,0.9,1.4,2.1,2.9,3.7,4.3,5.3,6.5,7.4,8.6,9.9,10.2,9.9,8.8,6.9,4.8,3.0,1.4,0.6,0.3,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Arkansas","avg":209.7,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.3,0.4,0.8,1.3,1.8,2.5,3.2,3.9,4.7,5.6,6.1,6.7,8.2,9.1,9.9,9.3,8.3,6.9,5.0,3.1,1.7,0.7,0.3,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Maine","avg":209.6,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.2,0.3,0.6,1.0,1.4,2.2,3.0,3.8,4.9,5.6,6.5,7.8,8.9,9.7,10.0,9.6,8.3,6.6,4.4,2.7,1.2,0.6,0.2,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Delaware","avg":209.5,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.2,0.4,0.6,1.1,1.6,2.4,3.0,3.8,4.6,5.8,6.5,7.5,8.6,9.6,9.8,9.7,8.1,6.4,4.3,2.9,1.6,0.8,0.3,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"District of Columbia","avg":209.2,"dist":[0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.2,0.3,0.5,0.8,1.4,2.2,2.7,3.6,4.7,5.4,5.9,6.7,7.2,7.9,7.5,7.4,7.5,6.9,6.1,4.9,3.8,2.7,1.7,1.0,0.5,0.3,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Michigan","avg":209.1,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.2,0.4,0.9,1.3,2.1,3.1,4.1,4.9,5.8,6.8,8.3,9.3,10.3,10.2,9.4,8.0,6.1,4.2,2.6,1.2,0.5,0.2,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Arizona","avg":208.1,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.2,0.5,1.0,1.3,1.8,2.6,3.4,4.0,4.9,5.9,6.8,7.4,8.3,9.0,9.2,8.7,7.4,6.3,4.3,2.8,1.9,1.1,0.6,0.2,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Oklahoma","avg":207.3,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.3,0.6,1.0,1.6,2.4,3.1,3.7,4.9,5.9,6.9,8.4,9.5,10.4,10.5,9.8,8.3,5.8,3.6,1.8,0.9,0.3,0.2,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Oregon","avg":207.0,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.1,0.2,0.4,0.8,1.3,1.9,2.9,3.7,4.6,5.2,6.2,6.8,7.4,8.1,8.3,8.5,8.3,7.6,6.4,4.7,3.0,1.6,0.9,0.4,0.3,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"West Virginia","avg":205.9,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.2,0.3,0.5,1.0,1.6,1.9,2.6,3.3,3.9,4.7,5.8,6.9,7.8,8.6,9.3,9.7,9.0,8.2,6.3,4.1,2.4,1.1,0.5,0.2,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"Alaska","avg":201.6,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.2,0.4,0.6,1.0,1.5,2.4,3.0,3.8,5.1,5.8,6.8,7.3,7.8,8.5,8.7,8.5,8.3,6.7,5.5,3.8,2.3,1.2,0.4,0.2,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]},{"name":"New Mexico","avg":200.6,"dist":[0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.2,0.4,0.6,1.0,1.6,2.3,3.2,4.2,4.8,5.9,6.7,7.4,8.2,8.5,9.1,9.0,8.4,6.8,5.0,3.4,1.8,1.0,0.5,0.2,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]}]};

const BINS = DATA.bins;
const STATES = DATA.states;
const national = STATES.find(s => s.name === 'National');

// Trim to useful range (bins 7–34 roughly, score 70-340)
const startBin = 7;
const endBin = 33;
const visibleBins = BINS.slice(startBin, endBin + 1);

const PALETTE = [
  '#c8440a','#2563b8','#059669','#7c3aed','#d97706',
  '#be185d','#0891b2','#4d7c0f','#dc2626','#6d28d9',
  '#0369a1','#b45309'
];

let selectedStates = [];
let colorMap = {};
let colorIdx = 0;

function getColor(name) {
  if (name === 'National') return '#1a1510';
  if (!colorMap[name]) {
    colorMap[name] = PALETTE[colorIdx % PALETTE.length];
    colorIdx++;
  }
  return colorMap[name];
}

// Populate select
const sel = document.getElementById('state-select');
STATES.filter(s => s.name !== 'National').sort((a,b) => a.name.localeCompare(b.name)).forEach(s => {
  const opt = document.createElement('option');
  opt.value = s.name;
  opt.textContent = s.name;
  sel.appendChild(opt);
});

function addSelected() {
  const val = sel.value;
  if (!val || selectedStates.includes(val)) return;
  selectedStates.push(val);
  sel.value = '';
  render();
}

function removeState(name) {
  selectedStates = selectedStates.filter(s => s !== name);
  render();
}

function resetToPreset() {
  colorMap = {}; colorIdx = 0;
  selectedStates = ['Massachusetts', 'National', 'New Mexico'];
  render();
}

// Stats
function updateStats() {
  const stateOnly = STATES.filter(s => s.name !== 'National');
  const avgs = stateOnly.map(s => s.avg);
  const spread = (Math.max(...avgs) - Math.min(...avgs)).toFixed(1);
  const top = stateOnly[0];
  const bot = stateOnly[stateOnly.length - 1];
  
  document.getElementById('stats-row').innerHTML = `
    <div class="stat-box">
      <div class="stat-box-label">Score Spread</div>
      <div class="stat-box-val">${spread} pts</div>
      <div class="stat-box-sub">across all states</div>
    </div>
    <div class="stat-box">
      <div class="stat-box-label">Highest</div>
      <div class="stat-box-val" style="color:#c8440a">${top.avg}</div>
      <div class="stat-box-sub">${top.name}</div>
    </div>
    <div class="stat-box">
      <div class="stat-box-label">Lowest</div>
      <div class="stat-box-val" style="color:#2563b8">${bot.avg}</div>
      <div class="stat-box-sub">${bot.name}</div>
    </div>
    <div class="stat-box">
      <div class="stat-box-label">National Avg</div>
      <div class="stat-box-val">215</div>
      <div class="stat-box-sub">Grade 4 Reading</div>
    </div>
  `;
}

// Canvas drawing
const canvas = document.getElementById('chart');
let hoverBin = null;
let hoverState = null;

function drawChart() {
  const dpr = window.devicePixelRatio || 1;
  const W = canvas.parentElement.clientWidth - 64;
  const H = 420;
  canvas.width = W * dpr;
  canvas.height = H * dpr;
  canvas.style.width = W + 'px';
  canvas.style.height = H + 'px';
  
  const ctx = canvas.getContext('2d');
  ctx.scale(dpr, dpr);
  
  const pad = { top: 24, right: 20, bottom: 50, left: 52 };
  const chartW = W - pad.left - pad.right;
  const chartH = H - pad.top - pad.bottom;
  
  const nBins = visibleBins.length;
  const allMaxY = 14; // fixed max y-axis
  
  function bx(i) { return pad.left + (i / (nBins - 1)) * chartW; }
  function by(v) { return pad.top + chartH - (v / allMaxY) * chartH; }
  
  // Background gridlines
  ctx.strokeStyle = '#f0ebe0';
  ctx.lineWidth = 1;
  for (let g = 0; g <= 4; g++) {
    const v = g * (allMaxY / 4);
    const y = by(v);
    ctx.beginPath();
    ctx.moveTo(pad.left, y);
    ctx.lineTo(pad.left + chartW, y);
    ctx.stroke();
    ctx.fillStyle = '#b0a090';
    ctx.font = '10px Syne Mono, monospace';
    ctx.textAlign = 'right';
    ctx.fillText(v.toFixed(0) + '%', pad.left - 8, y + 3.5);
  }
  
  // Draw all states as faint background
  const allStates = STATES.filter(s => s.name !== 'National' && !selectedStates.includes(s.name));
  allStates.forEach(s => {
    const pts = visibleBins.map((_, i) => ({ x: bx(i), y: by(s.dist[startBin + i]) }));
    ctx.beginPath();
    pts.forEach((p, i) => i === 0 ? ctx.moveTo(p.x, p.y) : ctx.lineTo(p.x, p.y));
    ctx.strokeStyle = 'rgba(180,165,145,0.2)';
    ctx.lineWidth = 1;
    ctx.stroke();
  });
  
  // Draw selected states
  const toRender = [];
  if (selectedStates.includes('National')) toRender.push(national);
  STATES.filter(s => selectedStates.includes(s.name) && s.name !== 'National').forEach(s => toRender.push(s));
  
  toRender.forEach(s => {
    const color = getColor(s.name);
    const pts = visibleBins.map((_, i) => ({ x: bx(i), y: by(s.dist[startBin + i]) }));
    
    // Filled area
    ctx.beginPath();
    ctx.moveTo(pts[0].x, by(0));
    pts.forEach(p => ctx.lineTo(p.x, p.y));
    ctx.lineTo(pts[pts.length-1].x, by(0));
    ctx.closePath();
    ctx.fillStyle = color + '18';
    ctx.fill();
    
    // Line
    ctx.beginPath();
    pts.forEach((p, i) => i === 0 ? ctx.moveTo(p.x, p.y) : ctx.lineTo(p.x, p.y));
    ctx.strokeStyle = color;
    ctx.lineWidth = s.name === 'National' ? 2.5 : 2;
    ctx.setLineDash(s.name === 'National' ? [6, 4] : []);
    ctx.stroke();
    ctx.setLineDash([]);
    
    // Mean line
    if (s.avg) {
      const meanBinIdx = BINS.findIndex(b => {
        const lo = parseInt(b.split('-')[0]);
        return lo >= s.avg;
      });
      if (meanBinIdx >= startBin && meanBinIdx <= endBin) {
        const mx = bx(meanBinIdx - startBin);
        ctx.beginPath();
        ctx.moveTo(mx, pad.top);
        ctx.lineTo(mx, pad.top + chartH);
        ctx.strokeStyle = color + '55';
        ctx.lineWidth = 1;
        ctx.setLineDash([3, 3]);
        ctx.stroke();
        ctx.setLineDash([]);
      }
    }
  });
  
  // Hover highlight
  if (hoverBin !== null) {
    const x = bx(hoverBin);
    ctx.beginPath();
    ctx.moveTo(x, pad.top);
    ctx.lineTo(x, pad.top + chartH);
    ctx.strokeStyle = 'rgba(26,21,16,0.2)';
    ctx.lineWidth = 1;
    ctx.stroke();
    
    // Dots on selected states
    toRender.forEach(s => {
      const v = s.dist[startBin + hoverBin];
      const color = getColor(s.name);
      ctx.beginPath();
      ctx.arc(x, by(v), 5, 0, Math.PI * 2);
      ctx.fillStyle = color;
      ctx.fill();
      ctx.strokeStyle = 'white';
      ctx.lineWidth = 1.5;
      ctx.stroke();
    });
  }
  
  // X axis labels
  ctx.fillStyle = '#b0a090';
  ctx.font = '10px Syne Mono, monospace';
  ctx.textAlign = 'center';
  visibleBins.forEach((b, i) => {
    if (i % 3 === 0) {
      const lo = b.split('-')[0];
      ctx.fillText(lo, bx(i), H - pad.bottom + 16);
    }
  });
  
  // Axis labels
  ctx.fillStyle = '#8a7a60';
  ctx.font = '11px Syne, sans-serif';
  ctx.textAlign = 'center';
  ctx.fillText('NAEP Scale Score', pad.left + chartW/2, H - 6);
  
  ctx.save();
  ctx.translate(14, pad.top + chartH/2);
  ctx.rotate(-Math.PI/2);
  ctx.fillText('% of Students', 0, 0);
  ctx.restore();
  
  return { bx, by, pad, chartW, chartH, nBins };
}

// Hover
canvas.addEventListener('mousemove', (e) => {
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const W = canvas.parentElement.clientWidth - 64;
  const pad = { left: 52, right: 20 };
  const chartW = W - pad.left - pad.right;
  const nBins = visibleBins.length;
  
  const relX = x - pad.left;
  const binFloat = (relX / chartW) * (nBins - 1);
  const binIdx = Math.round(binFloat);
  
  if (binIdx >= 0 && binIdx < nBins) {
    hoverBin = binIdx;
    
    // Find which state we're closest to
    const toRender = STATES.filter(s => selectedStates.includes(s.name));
    if (national && selectedStates.includes('National')) toRender.push(national);
    
    const tip = document.getElementById('tooltip');
    const range = visibleBins[binIdx];
    
    // Show multiple states
    let tipHtml = `<div class="tip-name">Score: ${range}</div>`;
    toRender.forEach(s => {
      const color = getColor(s.name);
      const pct = s.dist[startBin + binIdx];
      tipHtml += `<div class="tip-row"><span style="color:${color}">■</span><span style="color:${color};font-weight:600">${s.name}</span><span class="tip-val">${pct.toFixed(1)}%</span></div>`;
    });
    
    tip.innerHTML = tipHtml;
    tip.classList.add('show');
    tip.style.left = (e.clientX + 16) + 'px';
    tip.style.top = (e.clientY - 40) + 'px';
    
    drawChart();
  }
});

canvas.addEventListener('mouseleave', () => {
  hoverBin = null;
  document.getElementById('tooltip').classList.remove('show');
  drawChart();
});

function updateChips() {
  const chips = document.getElementById('chips');
  const allSelected = [...selectedStates];
  
  chips.innerHTML = allSelected.map(name => {
    const color = getColor(name);
    return `<div class="chip" style="background:${color}" onclick="removeState('${name}')">
      <span>${name}</span><span class="chip-x">×</span>
    </div>`;
  }).join('');
}

function updateLegend() {
  const legend = document.getElementById('legend');
  const toRender = STATES.filter(s => selectedStates.includes(s.name));
  
  legend.innerHTML = `
    <div class="legend-item" style="color:#b0a090">
      <div class="legend-swatch" style="background:rgba(180,165,145,0.4)"></div>
      All other states (background)
    </div>
    ${toRender.map(s => {
      const color = getColor(s.name);
      return `<div class="legend-item" style="color:${color}" onclick="removeState('${s.name}')">
        <div class="legend-swatch" style="background:${color}"></div>
        ${s.name} (avg ${s.avg})
      </div>`;
    }).join('')}
  `;
}

function render() {
  updateChips();
  updateLegend();
  drawChart();
}

window.addEventListener('resize', () => drawChart());

// Init
updateStats();
resetToPreset();
</script>
</body>
</html>
